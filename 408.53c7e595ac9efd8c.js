"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[408],{7408:(M,v,l)=>{l.r(v),l.d(v,{UsersModule:()=>L});var a=l(9808),x=l(325),u=l(3075),g=l(4850),_=l(7e3),e=l(5e3),d=l(6621),E=l(8966),T=l(5543),f=l(9224),C=l(7423),b=l(277),U=l(7322),y=l(7531),n=l(7510),p=l(7446),m=l(5245);function i(r,c){if(1&r&&(e.TgZ(0,"mat-card-subtitle"),e._uU(1),e.qZA()),2&r){const t=c.ngIf;e.xp6(1),e.lnq(" Usuario: ",t.id," / Nombre: ",t.name," ",t.last_name," ")}}function O(r,c){if(1&r&&(e.TgZ(0,"div",16)(1,"mat-checkbox",17),e._uU(2),e.qZA()()),2&r){const t=c.index,o=e.oxw(3);e.xp6(1),e.Q6J("formControlName",t),e.xp6(1),e.Oqu(o.roles[t].name)}}function N(r,c){if(1&r&&(e.TgZ(0,"section",14),e.YNc(1,O,3,2,"div",15),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.form.get("roles").controls)}}function w(r,c){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"p",18),e._uU(2,"Actualizar Contrase\xf1a"),e.qZA(),e.TgZ(3,"mat-form-field",19)(4,"mat-label"),e._uU(5,"Nueva Contrase\xf1a"),e.qZA(),e._UZ(6,"input",20),e.TgZ(7,"button",21),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return s.hide=!s.hide}),e.TgZ(8,"mat-icon"),e._uU(9),e.qZA()()(),e._UZ(10,"span",22),e.TgZ(11,"mat-form-field",19)(12,"mat-label"),e._uU(13,"Confirmar contrase\xf1a"),e.qZA(),e._UZ(14,"input",23),e.TgZ(15,"button",21),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return s.hide2=!s.hide2}),e.TgZ(16,"mat-icon"),e._uU(17),e.qZA()()(),e._UZ(18,"span",22)(19,"mvd-errors-messages",9),e.BQk()}if(2&r){const t=e.oxw(2);e.xp6(6),e.Q6J("type",t.hide?"password":"text"),e.xp6(1),e.uIk("aria-label","Hide password")("aria-pressed",t.hide),e.xp6(2),e.Oqu(t.hide?"visibility_off":"visibility"),e.xp6(5),e.Q6J("type",t.hide2?"password":"text"),e.xp6(1),e.uIk("aria-label","Hide password")("aria-pressed",t.hide),e.xp6(2),e.Oqu(t.hide?"visibility_off":"visibility"),e.xp6(2),e.Q6J("campo",t.form.errors)("name","Contrase\xf1a")}}function F(r,c){if(1&r){const t=e.EpF();e.TgZ(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title"),e._uU(3,"Ficha de Usuario"),e.qZA(),e.YNc(4,i,2,3,"mat-card-subtitle",2),e.TgZ(5,"div",3)(6,"button",4),e.NdJ("click",function(){return e.CHM(t),e.oxw().back()}),e._uU(7,"Volver"),e.qZA(),e.TgZ(8,"button",5),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSubmit()}),e._uU(9,"Guardar"),e.qZA()()(),e.TgZ(10,"mat-card-content")(11,"form",6)(12,"mat-form-field",7)(13,"mat-label"),e._uU(14,"Nombre"),e.qZA(),e._UZ(15,"input",8),e.TgZ(16,"mat-error"),e._UZ(17,"mvd-errors-messages",9),e.qZA()(),e.TgZ(18,"mat-form-field",7)(19,"mat-label"),e._uU(20,"Apellido"),e.qZA(),e._UZ(21,"input",10),e.TgZ(22,"mat-error"),e._UZ(23,"mvd-errors-messages",9),e.qZA()(),e.TgZ(24,"mat-form-field",7)(25,"mat-label"),e._uU(26,"Email"),e.qZA(),e._UZ(27,"input",11),e.TgZ(28,"mat-error"),e._UZ(29,"mvd-errors-messages",9),e.qZA()(),e.YNc(30,N,2,1,"section",12),e.YNc(31,w,20,10,"ng-container",2),e.qZA()(),e._UZ(32,"span",13),e.qZA()}if(2&r){const t=e.oxw();e.xp6(4),e.Q6J("ngIf",t.userEdit),e.xp6(4),e.Q6J("disabled",!t.form.valid),e.xp6(3),e.Q6J("formGroup",t.form),e.xp6(6),e.Q6J("campo",t.form.get("name").errors)("name","Nombre"),e.xp6(6),e.Q6J("campo",t.form.get("last_name").errors)("name","Apellido"),e.xp6(6),e.Q6J("campo",t.form.get("email").errors)("name","Email"),e.xp6(1),e.Q6J("ngIf",t.roles),e.xp6(1),e.Q6J("ngIf",t.userEdit)}}let A=(()=>{class r{constructor(t,o,s,h,Z,z){this.userService=t,this.activatedRoute=o,this.fb=s,this.router=h,this.dialog=Z,this.roleService=z,this.hide=!0,this.hide2=!0,this.changes=!1,this.subscriptions=[],this.createForm()}ngOnInit(){this.activatedRoute.paramMap.subscribe(t=>{t.params.id&&this.subscriptions.push(this.userService.getUser(t.params.id).subscribe(o=>{this.getRoles()})),t.params.id||(this.userEdit=null,this.getRoles())}),this.activatedRoute.queryParamMap.subscribe(t=>{var o,s;this.urlReturn=null===(o=null==t?void 0:t.params)||void 0===o?void 0:o.urlReturn,this.userId=null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.id})}createForm(){this.form=this.fb.group({name:[null,u.kI.required],last_name:[null,u.kI.required],email:[null,[u.kI.required,u.kI.email],_.e.validateEmailExist(this.userService)],roles:new u.Oe([]),password:"",confirmPassword:""},{validators:[r=>r.controls.password.value!==r.controls.confirmPassword.value?{validatePassword:!0}:{}]})}updateForm(t){this.form.patchValue({name:null==t?void 0:t.name,last_name:null==t?void 0:t.last_name,email:null==t?void 0:t.email,roles:this.buildRolesFormArray(),password:"",confirmPassword:""})}getRoles(){this.subscriptions.push(this.roleService.getRoles(1,1e3).pipe((0,g.U)(t=>t.data.data)).subscribe(t=>{this.roles=t,this.roles=t.map((o,s)=>(this.roles[s].group=o.name.split(".",1)[0],o)),this.subscriptions.push(this.userService.userOnEdit.subscribe(o=>{this.userEdit=o,this.userEdit?this.updateForm(this.userEdit):this.buildRolesFormArray()}))}))}buildRolesFormArray(){this.roles.forEach(t=>{var o,s;(null===(s=null===(o=this.userEdit)||void 0===o?void 0:o.roles)||void 0===s?void 0:s.length)>=1&&this.userEdit.roles.find(Z=>Z.name===t.name)?this.control.push(new u.NI(!0)):this.control.push(new u.NI(!1))})}get control(){return this.form.get("roles")}onSubmit(){let t=Object.assign({},this.form.value),o=t.roles.map((s,h)=>!!s&&this.roles[h].name).filter(s=>!1!==s);t.roles=o,this.userEdit?(""===t.password&&delete t.password,this.subscriptions.push(this.userService.updateUser(t).subscribe(s=>!!s&&this.back()))):this.subscriptions.push(this.userService.storeUser(t).subscribe(s=>!!s&&this.back()))}back(){this.router.navigate(this.urlReturn?[this.urlReturn]:["/usuarios"])}ngOnDestroy(){this.subscriptions.map(t=>t.unsubscribe())}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(d.f),e.Y36(x.gz),e.Y36(u.qu),e.Y36(x.F0),e.Y36(E.uw),e.Y36(T.f))},r.\u0275cmp=e.Xpm({type:r,selectors:[["mvd-user"]],decls:1,vars:1,consts:[["class","card mat-elevation-z2 animate__animated animate__slideInRight",4,"ngIf"],[1,"card","mat-elevation-z2","animate__animated","animate__slideInRight"],[4,"ngIf"],[1,"adasda"],["mat-stroked-button","","color","primary",1,"btn-submit",3,"click"],["mat-flat-button","","color","primary",1,"btn-submit",3,"disabled","click"],["fxFlex","100","fxLayout","row wrap","fxLayoutGap","20px","fxLayoutAlign","space-between center",3,"formGroup"],["appearance","outline","fxFlex.xs","100","fxFlex","calc(33.3% - 20px)","appearance","outline"],["matInput","","formControlName","name","placeholder","Nombre"],[3,"campo","name"],["matInput","","formControlName","last_name","placeholder","Apellido"],["matInput","","formControlName","email","placeholder","Email"],["fxFlex","100","fxLayout","row wrap","fxLayoutAlign","start center",4,"ngIf"],[1,"border"],["fxFlex","100","fxLayout","row wrap","fxLayoutAlign","start center"],["fxFlex","100","class","content-group-checkbox","fxLayout","column wrap","formArrayName","roles",4,"ngFor","ngForOf"],["fxFlex","100","fxLayout","column wrap","formArrayName","roles",1,"content-group-checkbox"],[3,"formControlName"],["fxFlex","100",1,"title"],["appearance","outline","fxFlex","100","fxFlex","30","appearance","outline"],["matInput","","formControlName","password","placeholder","*******",3,"type"],["mat-icon-button","","matSuffix","",3,"click"],["fxFlex","100"],["matInput","","formControlName","confirmPassword","placeholder","*******",3,"type"]],template:function(t,o){1&t&&e.YNc(0,F,33,11,"mat-card",0),2&t&&e.Q6J("ngIf",o.form)},directives:[a.O5,f.a8,f.dk,f.n5,f.$j,C.lW,f.dn,u._Y,u.JL,b.yH,b.xw,b.SQ,b.Wh,u.sg,U.KE,U.hX,y.Nt,u.Fj,u.JJ,u.u,U.TO,n.g,a.sg,u.CE,p.oG,U.R9,m.Hw],styles:[".adasda[_ngcontent-%COMP%]{justify-content:flex-end;display:flex}@media only screen and (max-width: 576px){.adasda[_ngcontent-%COMP%]{display:block!important}}.tabs-content[_ngcontent-%COMP%]{margin-top:3rem}.mat-card-actions[_ngcontent-%COMP%]{padding-right:1.5rem}.btn-submit[_ngcontent-%COMP%]{width:100px;line-height:2.2;margin:1rem}.mat-card-subtitle[_ngcontent-%COMP%]{padding-left:1rem!important}.title[_ngcontent-%COMP%]{font-weight:500;margin-top:20px}"]}),r})();var I=l(6087),R=l(2986),P=l(953),q=l(3160);const Q=function(){return[20,50,100]};let S=(()=>{class r{constructor(t,o){this.userService=t,this.router=o,this.columns=[{title:"C\xf3digo",col:"id"},{title:"Nombre",col:"name"},{title:"Email",col:"email"}],this.pageDefault=1,this.perPage=10,this.orden="desc",this.filter="",this.result=this.userService.resultItems$}paginatorChange(t){this.getUsers(t.pageIndex+1,t.pageSize)}ngOnInit(){this.getUsers(this.pageDefault,this.perPage,this.filter,this.orden)}add(){this.router.navigate(["/usuarios/usuario"],{queryParams:{urlReturn:this.router.url}})}getUsers(t,o,s,h){this.subscroption=this.userService.getUsers(t,o,s,h).subscribe(Z=>this.loadData())}loadData(){this.dataSource=this.result.pipe((0,g.U)(t=>t.data.data.map(s=>({id:s.id,name:`${s.name} ${s.last_name}`,email:s.email})))),this.totalResut=this.result.pipe((0,g.U)(t=>t.data.total))}search(t){this.getUsers(this.pageDefault,this.perPage,t,this.orden)}deleteItem(t){return this.userService.deleteUser(t)}itemAction(t){"delete"===t.action&&this.deleteItem(t.element.id).pipe((0,R.q)(1)).subscribe(o=>console.log(o)),"edit"===t.action&&this.router.navigate(["/usuarios/usuario",t.element.id],{queryParams:{urlReturn:this.router.url}})}ngOnDestroy(){this.subscroption.unsubscribe()}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(d.f),e.Y36(x.F0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["mvd-users-table"]],viewQuery:function(t,o){if(1&t&&e.Gf(I.NW,7),2&t){let s;e.iGM(s=e.CRH())&&(o.paginator=s.first)}},decls:13,vars:11,consts:[[1,"header-table"],[3,"noteFilterBy","changeSearch"],[1,"actions"],["mat-flat-button","","color","primary",3,"click"],[1,"material-icons-round"],[3,"columns","dataSource","actionChange"],["showFirstLastButtons","",3,"length","pageSize","pageSizeOptions","page"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"mvd-input-search",1),e.NdJ("changeSearch",function(h){return o.search(h)}),e.qZA(),e.TgZ(2,"div",2)(3,"button",3),e.NdJ("click",function(){return o.add()}),e.TgZ(4,"mat-icon",4),e._uU(5,"add"),e.qZA(),e.TgZ(6,"span"),e._uU(7,"Crear"),e.qZA()()()(),e.TgZ(8,"mat-card-content")(9,"mvd-data-table",5),e.NdJ("actionChange",function(h){return o.itemAction(h)}),e.ALo(10,"async"),e.qZA(),e.TgZ(11,"mat-paginator",6),e.NdJ("page",function(h){return o.paginatorChange(h)}),e.ALo(12,"async"),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("noteFilterBy","Filtra nombre, apellido o email"),e.xp6(8),e.Q6J("columns",o.columns)("dataSource",e.lcZ(10,6,o.dataSource)),e.xp6(2),e.Q6J("length",e.lcZ(12,8,o.totalResut))("pageSize",o.perPage)("pageSizeOptions",e.DdM(10,Q)))},directives:[P.V,C.lW,m.Hw,f.dn,q.Q,I.NW],pipes:[a.Ov],styles:[".header-table[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr;grid-gap:1rem;gap:1rem}.header-table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);justify-content:space-around!important;justify-items:right;grid-column-gap:5px;column-gap:5px}.header-table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:38px}"]}),r})();const k=[{path:"",component:(()=>{class r{constructor(){}ngOnInit(){}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["mvd-users"]],decls:8,vars:0,consts:[[1,"card","mat-elevation-z16","animate__animated","animate__slideInRight"],[1,"border"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),e._uU(3,"Usuarios"),e.qZA(),e.TgZ(4,"mat-card-subtitle"),e._uU(5,"Administrar Usuarios"),e.qZA()(),e._UZ(6,"mvd-users-table")(7,"span",1),e.qZA())},directives:[f.a8,f.dk,f.n5,f.$j,S],styles:[""]}),r})()},{path:"usuario",component:A},{path:"usuario/:id",component:A}];let Y=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[x.Bz.forChild(k)],x.Bz]}),r})();var D=l(8203);let L=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[a.ez,Y,D.m]]}),r})()},7510:(M,v,l)=>{l.d(v,{g:()=>y});var a=l(5e3),x=l(9808),u=l(7322);function g(n,p){if(1&n&&(a.TgZ(0,"mat-error"),a._uU(1),a.qZA()),2&n){const m=a.oxw();a.xp6(1),a.Oqu(m.getErrorMessage("notIncludedIn"))}}function _(n,p){if(1&n&&(a.TgZ(0,"mat-error"),a._uU(1),a.qZA()),2&n){const m=a.oxw();a.xp6(1),a.Oqu(m.getErrorMessage("validateNumDoc"))}}function e(n,p){if(1&n&&(a.TgZ(0,"mat-error"),a._uU(1),a.qZA()),2&n){const m=a.oxw();a.xp6(1),a.Oqu(m.getErrorMessage("validateCode"))}}function d(n,p){if(1&n&&(a.TgZ(0,"mat-error"),a._uU(1),a.qZA()),2&n){const m=a.oxw();a.xp6(1),a.Oqu(m.getErrorMessage("email"))}}function E(n,p){if(1&n&&(a.TgZ(0,"mat-error"),a._uU(1),a.qZA()),2&n){const m=a.oxw();a.xp6(1),a.Oqu(m.getErrorMessage("validateEmailExist"))}}function T(n,p){if(1&n&&(a.TgZ(0,"mat-error"),a._uU(1),a.qZA()),2&n){const m=a.oxw();a.xp6(1),a.Oqu(m.getErrorMessage("required"))}}function f(n,p){if(1&n&&(a.TgZ(0,"mat-error"),a._uU(1),a.qZA()),2&n){const m=a.oxw();a.xp6(1),a.Oqu(m.getErrorMessage("number"))}}function C(n,p){if(1&n&&(a.TgZ(0,"mat-error"),a._uU(1),a.qZA()),2&n){const m=a.oxw();a.xp6(1),a.Oqu(m.getErrorMessage("date"))}}function b(n,p){if(1&n&&(a.TgZ(0,"mat-error"),a._uU(1),a.qZA()),2&n){const m=a.oxw();a.xp6(1),a.Oqu(m.getErrorMessage("validateRoleExist"))}}function U(n,p){if(1&n&&(a.TgZ(0,"mat-error"),a._uU(1),a.qZA()),2&n){const m=a.oxw();a.xp6(1),a.Oqu(m.getErrorMessage("validatePassword"))}}let y=(()=>{class n{constructor(){}ngOnInit(){}getErrorMessage(m){let i;switch(console.log(m),m){case"validateNumDoc":case"validateCode":case"notIncludedIn":i=`${this.name} ya existe`;break;case"validateEmailExist":i="Email ya existe";break;case"email":i="Email no v\xe1lido";break;case"date":i="Formato de fecha inv\xe1lido";break;case"number":i=`${this.name} admite solamente n\xfameros`;break;case"required":i=`${this.name} es necesario`;break;case"validateRoleExist":i="El rol ya existe";break;case"validatePassword":i="Contrase\xf1as no coinciden";break;default:i="No v\xe1lido"}return i}}return n.\u0275fac=function(m){return new(m||n)},n.\u0275cmp=a.Xpm({type:n,selectors:[["mvd-errors-messages"]],inputs:{campo:"campo",name:"name"},decls:10,vars:10,consts:[[4,"ngIf"]],template:function(m,i){1&m&&(a.YNc(0,g,2,1,"mat-error",0),a.YNc(1,_,2,1,"mat-error",0),a.YNc(2,e,2,1,"mat-error",0),a.YNc(3,d,2,1,"mat-error",0),a.YNc(4,E,2,1,"mat-error",0),a.YNc(5,T,2,1,"mat-error",0),a.YNc(6,f,2,1,"mat-error",0),a.YNc(7,C,2,1,"mat-error",0),a.YNc(8,b,2,1,"mat-error",0),a.YNc(9,U,2,1,"mat-error",0)),2&m&&(a.Q6J("ngIf",null==i.campo?null:i.campo.notIncludedIn),a.xp6(1),a.Q6J("ngIf",null==i.campo?null:i.campo.validateNumDoc),a.xp6(1),a.Q6J("ngIf",null==i.campo?null:i.campo.validateCode),a.xp6(1),a.Q6J("ngIf",null==i.campo?null:i.campo.email),a.xp6(1),a.Q6J("ngIf",null==i.campo?null:i.campo.validateEmailExist),a.xp6(1),a.Q6J("ngIf",null==i.campo?null:i.campo.required),a.xp6(1),a.Q6J("ngIf",null==i.campo?null:i.campo.number),a.xp6(1),a.Q6J("ngIf",null==i.campo?null:i.campo.date),a.xp6(1),a.Q6J("ngIf",null==i.campo?null:i.campo.validateRoleExist),a.xp6(1),a.Q6J("ngIf",null==i.campo?null:i.campo.validatePassword))},directives:[x.O5,u.TO],styles:[""],changeDetection:0}),n})()},7e3:(M,v,l)=>{l.d(v,{e:()=>x});var a=l(4850);class x{constructor(){}static validateNumDoc(g){return _=>g.checkExist("n_doc",_.value).pipe((0,a.U)(d=>null===d.exist?null:{validateNumDoc:d.exist}))}static validateCode(g){return _=>g.checkExist("code",_.value).pipe((0,a.U)(d=>null===d.exist?null:{validateCode:d.exist}))}static validateEmailExist(g){return _=>g.checkEmailExist(_.value).pipe((0,a.U)(d=>null===d.exist?null:{validateEmailExist:d.exist}))}static validateRoleExist(g){return _=>g.checkRoleExist(_.value).pipe((0,a.U)(d=>null===d.exist?null:{validateRoleExist:d.exist}))}}}}]);