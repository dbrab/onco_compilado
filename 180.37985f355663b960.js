"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[180],{3180:(A,_,a)=>{a.r(_),a.d(_,{RolesModule:()=>he});var r=a(9808),x=a(325),m=a(3075),g=a(4850),v=a(7e3),e=a(5e3),p=a(5543),Z=a(278),M=a(8966),f=a(9224),C=a(277),E=a(7423),y=a(7322),P=a(7531),c=a(7510),h=a(7582),u=a(6787),l=a(3753);let D=(()=>{class o{constructor(t){this.host=t,this.checkChanges$=(0,l.R)(this.host.nativeElement,"change").pipe((0,g.U)(n=>n.target.checked))}set checked(t){this.host.nativeElement.checked=t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.SBq))},o.\u0275dir=e.lG2({type:o,selectors:[["","selectGroup",""]]}),o})();var Y=a(8929),L=a(2654),q=a(7625);const G=e.GuJ,j=Symbol("__destroy"),I=Symbol("__decoratorApplied");function k(o){return"string"==typeof o?Symbol(`__destroy__${o}`):j}function N(o,i){o[i]||(o[i]=new Y.xQ)}function U(o,i){o[i]&&(o[i].next(),o[i].complete(),o[i]=null)}function F(o){o instanceof L.w&&o.unsubscribe()}function S(o,i){return function(){var t;if(o&&o.call(this),U(this,k()),i.arrayName)return function B(o){Array.isArray(o)&&o.forEach(F)}(this[i.arrayName]);if(i.checkProperties)for(const n in this)(null===(t=i.blackList)||void 0===t?void 0:t.includes(n))||F(this[n])}}function w(o,i){return t=>{const n=k(i);return"string"==typeof i?function V(o,i,t){const n=o[i];N(o,t),o[i]=function(){n.apply(this,arguments),U(this,t),o[i]=n}}(o,i,n):N(o,n),t.pipe((0,q.R)(o[n]))}}let b=class{ngAfterContentInit(){this.selectGroup.checkChanges$.pipe(w(this)).subscribe(t=>{this.controls.forEach(({control:n})=>n.patchValue(t))});const i=this.controls.map(({control:t})=>t.valueChanges);(0,u.T)(...i).pipe(w(this)).subscribe(()=>{this.selectGroup.checked=this.controls.toArray().every(({control:t})=>t.value)})}};b.\u0275fac=function(i){return new(i||b)},b.\u0275dir=e.lG2({type:b,selectors:[["","checkChildren",""]],contentQueries:function(i,t,n){if(1&i&&(e.Suo(n,D,5),e.Suo(n,m.a5,5)),2&i){let s;e.iGM(s=e.CRH())&&(t.selectGroup=s.first),e.iGM(s=e.CRH())&&(t.controls=s)}}}),b=(0,h.gn)([function K(o={}){return i=>{!function z(o){return!!o[G]}(i)?function W(o,i){o.prototype.ngOnDestroy=S(o.prototype.ngOnDestroy,i)}(i,o):function H(o,i){const t=o.\u0275pipe;t.onDestroy=S(t.onDestroy,i)}(i,o),function $(o){o.prototype[I]=!0}(i)}}()],b);let ee=(()=>{class o{transform(t,n){return function X(o,i="group"){if(!o)return[];const t=[],n={};let s=0;return o.forEach((d,T)=>{const R=Object.assign(Object.assign({},d),{index:T}),O=d[i];n.hasOwnProperty(O)?t[n[O]].children.push(R):(n[O]=s++,t.push({name:O,children:[R]}))}),t}(t,n)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275pipe=e.Yjl({name:"tree",type:o,pure:!0}),o})();function te(o,i){if(1&o&&(e.TgZ(0,"mat-card-subtitle"),e._uU(1),e.qZA()),2&o){const t=i.ngIf;e.xp6(1),e.lnq(" Rol: ",t.id," / Nombre: ",t.name," / Descripci\xf3n: ",t.description," ")}}function oe(o,i){if(1&o&&(e.TgZ(0,"label",22),e._UZ(1,"input",23),e.TgZ(2,"span",19),e._uU(3),e.qZA()()),2&o){const t=i.$implicit,n=e.oxw(4);e.xp6(1),e.Q6J("formControlName",t.index),e.xp6(2),e.Oqu(n.permissions[t.index].description)}}function re(o,i){if(1&o&&(e.TgZ(0,"div",15)(1,"div",16)(2,"label",17),e._UZ(3,"input",18),e.TgZ(4,"span",19),e._uU(5),e.qZA()()(),e.TgZ(6,"div",20),e.YNc(7,oe,4,2,"label",21),e.qZA()()),2&o){const t=i.$implicit,n=e.oxw(3);e.xp6(5),e.Oqu(n.traslateTitle(t.name)),e.xp6(2),e.Q6J("ngForOf",t.children)}}function ne(o,i){if(1&o&&(e.TgZ(0,"section",13),e.YNc(1,re,8,2,"div",14),e.ALo(2,"tree"),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,t.permissions))}}function ie(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title"),e._uU(3,"Ficha de Rol"),e.qZA(),e.YNc(4,te,2,3,"mat-card-subtitle",2),e.TgZ(5,"div",3)(6,"button",4),e.NdJ("click",function(){return e.CHM(t),e.oxw().back()}),e._uU(7,"Volver"),e.qZA(),e.TgZ(8,"button",5),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSubmit()}),e._uU(9,"Guardar"),e.qZA()()(),e.TgZ(10,"mat-card-content")(11,"form",6)(12,"mat-form-field",7)(13,"mat-label"),e._uU(14,"Nombre"),e.qZA(),e._UZ(15,"input",8),e.TgZ(16,"mat-error"),e._UZ(17,"mvd-errors-messages",9),e.qZA()(),e.TgZ(18,"mat-form-field",7)(19,"mat-label"),e._uU(20,"Descripci\xf3n"),e.qZA(),e._UZ(21,"input",10),e.TgZ(22,"mat-error"),e._UZ(23,"mvd-errors-messages",9),e.qZA()(),e.YNc(24,ne,3,3,"section",11),e.qZA()(),e._UZ(25,"span",12),e.qZA()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("ngIf",t.roleEdit),e.xp6(4),e.Q6J("disabled",!t.form.valid),e.xp6(3),e.Q6J("formGroup",t.form),e.xp6(6),e.Q6J("campo",t.form.get("name").errors)("name","Nombre"),e.xp6(6),e.Q6J("campo",t.form.get("description").errors)("name","Descripci\xf3n"),e.xp6(1),e.Q6J("ngIf",t.permissions)}}let J=(()=>{class o{constructor(t,n,s,d,T,R){this.roleService=t,this.permissionService=n,this.activatedRoute=s,this.fb=d,this.router=T,this.dialog=R,this.changes=!1,this.subscriptions=[],this.createForm()}ngOnInit(){this.activatedRoute.paramMap.subscribe(t=>{t.params.id&&this.subscriptions.push(this.roleService.getRole(t.params.id).subscribe(n=>{this.getPermissions()})),t.params.id||(this.roleEdit=null,this.getPermissions())}),this.activatedRoute.queryParamMap.subscribe(t=>{var n,s;this.urlReturn=null===(n=null==t?void 0:t.params)||void 0===n?void 0:n.urlReturn,this.roleId=null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.id})}createForm(){this.form=this.fb.group({name:[null,m.kI.required,v.e.validateRoleExist(this.roleService)],description:[null,m.kI.required],permissions:new m.Oe([])})}updateForm(t){this.form.patchValue({name:null==t?void 0:t.name,description:null==t?void 0:t.description,permissions:this.buildPermissionFormArray()})}getPermissions(){this.subscriptions.push(this.permissionService.getPermissions(1,1e3).pipe((0,g.U)(t=>t.data.data)).subscribe(t=>{this.permissions=t,this.permissions=t.map((n,s)=>(this.permissions[s].group=n.name.split(".",1)[0],n)),this.subscriptions.push(this.roleService.roleOnEdit.subscribe(n=>{this.roleEdit=n,this.roleEdit?this.updateForm(this.roleEdit):this.buildPermissionFormArray()}))}))}buildPermissionFormArray(){this.permissions.forEach(t=>{var n;(null===(n=this.roleEdit)||void 0===n?void 0:n.permissions.length)>=1&&this.roleEdit.permissions.find(d=>d.name===t.name)?this.control.push(new m.NI(!0)):this.control.push(new m.NI(!1))})}get control(){return this.form.get("permissions")}onSubmit(){let t=Object.assign({},this.form.value),n=t.permissions.map((s,d)=>!!s&&this.permissions[d].name).filter(s=>!1!==s);t.permissions=n,this.subscriptions.push(this.roleEdit?this.roleService.updateRole(t).subscribe(s=>!!s&&this.back()):this.roleService.storeRole(t).subscribe(s=>!!s&&this.back()))}back(){this.router.navigate(this.urlReturn?[this.urlReturn]:["/roles"])}ngOnDestroy(){this.subscriptions.map(t=>t.unsubscribe())}traslateTitle(t){let n;switch(t){case"user":n="Usuarios";break;case"permission":n="Permisos";break;case"sample":n="Muestras";break;case"ubication":n="Geolocalizaci\xf3n";break;case"patient":n="Pacientes";break;case"role":n="Roles";break;default:n=t}return n}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(p.f),e.Y36(Z.q),e.Y36(x.gz),e.Y36(m.qu),e.Y36(x.F0),e.Y36(M.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["mvd-role"]],decls:1,vars:1,consts:[["class","card mat-elevation-z2 animate__animated animate__slideInRight",4,"ngIf"],[1,"card","mat-elevation-z2","animate__animated","animate__slideInRight"],[4,"ngIf"],["fxLayoutAlign","end center"],["mat-stroked-button","","color","primary",1,"btn-submit",3,"click"],["mat-flat-button","","color","primary",1,"btn-submit",3,"disabled","click"],["fxFlex","100","fxLayout","row wrap","fxLayoutGap","20px","fxLayoutAlign","space-between center",3,"formGroup"],["appearance","outline","fxFlex","48","fxLayout","column","appearance","outline"],["matInput","","formControlName","name","placeholder","Nombre"],[3,"campo","name"],["matInput","","formControlName","description","placeholder","Descripci\xf3n"],["fxFlex","100","fxLayout","row wrap","fxLayoutAlign","start center",4,"ngIf"],[1,"border"],["fxFlex","100","fxLayout","row wrap","fxLayoutAlign","start center"],["fxFlex","calc(33.3% - 10px)","class","content-group-checkbox","fxLayout","column wrap","checkChildren","",4,"ngFor","ngForOf"],["fxFlex","calc(33.3% - 10px)","fxLayout","column wrap","checkChildren","",1,"content-group-checkbox"],["fxFlex","100","fxLayout","row",1,"checkbox-group-title"],[1,"material-checkbox"],["type","checkbox","selectGroup",""],["fxLayoutAlign","start center"],["fxFlex","100","fxLayout","column",1,"checkbox-items"],["class","material-checkbox","formArrayName","permissions",4,"ngFor","ngForOf"],["formArrayName","permissions",1,"material-checkbox"],["type","checkbox",3,"formControlName"]],template:function(t,n){1&t&&e.YNc(0,ie,26,8,"mat-card",0),2&t&&e.Q6J("ngIf",n.form)},directives:[r.O5,f.a8,f.dk,f.n5,f.$j,C.Wh,E.lW,f.dn,m._Y,m.JL,C.yH,C.xw,C.SQ,m.sg,y.KE,y.hX,P.Nt,m.Fj,m.JJ,m.u,y.TO,c.g,r.sg,b,D,m.CE,m.Wl],pipes:[ee],styles:[".tabs-content[_ngcontent-%COMP%]{margin-top:3rem}.mat-card-actions[_ngcontent-%COMP%]{padding-right:1.5rem}.btn-submit[_ngcontent-%COMP%]{width:100px;line-height:2.2;margin:1rem}.mat-card-subtitle[_ngcontent-%COMP%]{padding-left:1rem!important}.index[_ngcontent-%COMP%]{color:red;width:33.3%}.show[_ngcontent-%COMP%]{color:green;width:33.3%}.create[_ngcontent-%COMP%]{width:33.3%;color:#00f}.delete[_ngcontent-%COMP%]{width:33.3%;color:gray}.update[_ngcontent-%COMP%]{width:33.3%;color:#8a2be2}.content-group-checkbox[_ngcontent-%COMP%]{box-sizing:border-box;border:1px solid #e6e6e6;border-radius:10px;padding:10px;margin:5px}.checkbox-group-title[_ngcontent-%COMP%]{box-sizing:border-box}.checkbox-group-title[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:10pt!important;font-weight:500}.checkbox-items[_ngcontent-%COMP%]{box-sizing:border-box;margin-left:1rem}.checkbox-items[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:10pt!important}"]}),o})();var Q=a(6087),se=a(2986),ae=a(953),ce=a(5245),le=a(3160);const ue=function(){return[20,50,100]};let me=(()=>{class o{constructor(t,n){this.roleService=t,this.router=n,this.columns=[{title:"C\xf3digo",col:"id"},{title:"Nombre",col:"name"},{title:"Descripci\xf3n",col:"description"}],this.pageDefault=1,this.perPage=10,this.orden="desc",this.filter="",this.result=this.roleService.resultItems$}paginatorChange(t){this.getRoles(t.pageIndex+1,t.pageSize)}ngOnInit(){this.getRoles(this.pageDefault,this.perPage,this.filter,this.orden)}add(){this.router.navigate(["/roles/rol"],{queryParams:{urlReturn:this.router.url}})}getRoles(t,n,s,d){this.subscroption=this.roleService.getRoles(t,n,s,d).subscribe(T=>this.loadData())}loadData(){this.dataSource=this.result.pipe((0,g.U)(t=>t.data.data.map(s=>({id:s.id,name:s.name,description:s.description})))),this.totalResut=this.result.pipe((0,g.U)(t=>t.data.total))}search(t){this.getRoles(this.pageDefault,this.perPage,t,this.orden)}deleteItem(t){return this.roleService.deleteRole(t)}itemAction(t){"delete"===t.action&&this.deleteItem(t.element.id).pipe((0,se.q)(1)).subscribe(n=>console.log(n)),"edit"===t.action&&this.router.navigate(["/roles/rol",t.element.id],{queryParams:{urlReturn:this.router.url}})}ngOnDestroy(){this.subscroption.unsubscribe()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(p.f),e.Y36(x.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["mvd-roles-table"]],viewQuery:function(t,n){if(1&t&&e.Gf(Q.NW,7),2&t){let s;e.iGM(s=e.CRH())&&(n.paginator=s.first)}},decls:13,vars:11,consts:[[1,"header-table"],[3,"noteFilterBy","changeSearch"],[1,"actions"],["mat-flat-button","","color","primary",3,"click"],[1,"material-icons-round"],[3,"columns","dataSource","actionChange"],["showFirstLastButtons","",3,"length","pageSize","pageSizeOptions","page"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"mvd-input-search",1),e.NdJ("changeSearch",function(d){return n.search(d)}),e.qZA(),e.TgZ(2,"div",2)(3,"button",3),e.NdJ("click",function(){return n.add()}),e.TgZ(4,"mat-icon",4),e._uU(5,"add"),e.qZA(),e.TgZ(6,"span"),e._uU(7,"Crear"),e.qZA()()()(),e.TgZ(8,"mat-card-content")(9,"mvd-data-table",5),e.NdJ("actionChange",function(d){return n.itemAction(d)}),e.ALo(10,"async"),e.qZA(),e.TgZ(11,"mat-paginator",6),e.NdJ("page",function(d){return n.paginatorChange(d)}),e.ALo(12,"async"),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("noteFilterBy","Filtra nombre"),e.xp6(8),e.Q6J("columns",n.columns)("dataSource",e.lcZ(10,6,n.dataSource)),e.xp6(2),e.Q6J("length",e.lcZ(12,8,n.totalResut))("pageSize",n.perPage)("pageSizeOptions",e.DdM(10,ue)))},directives:[ae.V,E.lW,ce.Hw,f.dn,le.Q,Q.NW],pipes:[r.Ov],styles:[".header-table[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr;grid-gap:1rem;gap:1rem}.header-table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);justify-content:space-around!important;justify-items:right;grid-column-gap:5px;column-gap:5px}.header-table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:38px}"]}),o})();const pe=[{path:"",component:(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["mvd-roles"]],decls:8,vars:0,consts:[[1,"card","mat-elevation-z16","animate__animated","animate__slideInRight"],[1,"border"]],template:function(t,n){1&t&&(e.TgZ(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),e._uU(3,"Roles"),e.qZA(),e.TgZ(4,"mat-card-subtitle"),e._uU(5,"Administrar Roles"),e.qZA()(),e._UZ(6,"mvd-roles-table")(7,"span",1),e.qZA())},directives:[f.a8,f.dk,f.n5,f.$j,me],styles:[""]}),o})()},{path:"rol",component:J},{path:"rol/:id",component:J}];let de=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[x.Bz.forChild(pe)],x.Bz]}),o})();var ge=a(8203);let he=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[r.ez,de,ge.m]]}),o})()},7510:(A,_,a)=>{a.d(_,{g:()=>P});var r=a(5e3),x=a(9808),m=a(7322);function g(c,h){if(1&c&&(r.TgZ(0,"mat-error"),r._uU(1),r.qZA()),2&c){const u=r.oxw();r.xp6(1),r.Oqu(u.getErrorMessage("notIncludedIn"))}}function v(c,h){if(1&c&&(r.TgZ(0,"mat-error"),r._uU(1),r.qZA()),2&c){const u=r.oxw();r.xp6(1),r.Oqu(u.getErrorMessage("validateNumDoc"))}}function e(c,h){if(1&c&&(r.TgZ(0,"mat-error"),r._uU(1),r.qZA()),2&c){const u=r.oxw();r.xp6(1),r.Oqu(u.getErrorMessage("validateCode"))}}function p(c,h){if(1&c&&(r.TgZ(0,"mat-error"),r._uU(1),r.qZA()),2&c){const u=r.oxw();r.xp6(1),r.Oqu(u.getErrorMessage("email"))}}function Z(c,h){if(1&c&&(r.TgZ(0,"mat-error"),r._uU(1),r.qZA()),2&c){const u=r.oxw();r.xp6(1),r.Oqu(u.getErrorMessage("validateEmailExist"))}}function M(c,h){if(1&c&&(r.TgZ(0,"mat-error"),r._uU(1),r.qZA()),2&c){const u=r.oxw();r.xp6(1),r.Oqu(u.getErrorMessage("required"))}}function f(c,h){if(1&c&&(r.TgZ(0,"mat-error"),r._uU(1),r.qZA()),2&c){const u=r.oxw();r.xp6(1),r.Oqu(u.getErrorMessage("number"))}}function C(c,h){if(1&c&&(r.TgZ(0,"mat-error"),r._uU(1),r.qZA()),2&c){const u=r.oxw();r.xp6(1),r.Oqu(u.getErrorMessage("date"))}}function E(c,h){if(1&c&&(r.TgZ(0,"mat-error"),r._uU(1),r.qZA()),2&c){const u=r.oxw();r.xp6(1),r.Oqu(u.getErrorMessage("validateRoleExist"))}}function y(c,h){if(1&c&&(r.TgZ(0,"mat-error"),r._uU(1),r.qZA()),2&c){const u=r.oxw();r.xp6(1),r.Oqu(u.getErrorMessage("validatePassword"))}}let P=(()=>{class c{constructor(){}ngOnInit(){}getErrorMessage(u){let l;switch(console.log(u),u){case"validateNumDoc":case"validateCode":case"notIncludedIn":l=`${this.name} ya existe`;break;case"validateEmailExist":l="Email ya existe";break;case"email":l="Email no v\xe1lido";break;case"date":l="Formato de fecha inv\xe1lido";break;case"number":l=`${this.name} admite solamente n\xfameros`;break;case"required":l=`${this.name} es necesario`;break;case"validateRoleExist":l="El rol ya existe";break;case"validatePassword":l="Contrase\xf1as no coinciden";break;default:l="No v\xe1lido"}return l}}return c.\u0275fac=function(u){return new(u||c)},c.\u0275cmp=r.Xpm({type:c,selectors:[["mvd-errors-messages"]],inputs:{campo:"campo",name:"name"},decls:10,vars:10,consts:[[4,"ngIf"]],template:function(u,l){1&u&&(r.YNc(0,g,2,1,"mat-error",0),r.YNc(1,v,2,1,"mat-error",0),r.YNc(2,e,2,1,"mat-error",0),r.YNc(3,p,2,1,"mat-error",0),r.YNc(4,Z,2,1,"mat-error",0),r.YNc(5,M,2,1,"mat-error",0),r.YNc(6,f,2,1,"mat-error",0),r.YNc(7,C,2,1,"mat-error",0),r.YNc(8,E,2,1,"mat-error",0),r.YNc(9,y,2,1,"mat-error",0)),2&u&&(r.Q6J("ngIf",null==l.campo?null:l.campo.notIncludedIn),r.xp6(1),r.Q6J("ngIf",null==l.campo?null:l.campo.validateNumDoc),r.xp6(1),r.Q6J("ngIf",null==l.campo?null:l.campo.validateCode),r.xp6(1),r.Q6J("ngIf",null==l.campo?null:l.campo.email),r.xp6(1),r.Q6J("ngIf",null==l.campo?null:l.campo.validateEmailExist),r.xp6(1),r.Q6J("ngIf",null==l.campo?null:l.campo.required),r.xp6(1),r.Q6J("ngIf",null==l.campo?null:l.campo.number),r.xp6(1),r.Q6J("ngIf",null==l.campo?null:l.campo.date),r.xp6(1),r.Q6J("ngIf",null==l.campo?null:l.campo.validateRoleExist),r.xp6(1),r.Q6J("ngIf",null==l.campo?null:l.campo.validatePassword))},directives:[x.O5,m.TO],styles:[""],changeDetection:0}),c})()},7e3:(A,_,a)=>{a.d(_,{e:()=>x});var r=a(4850);class x{constructor(){}static validateNumDoc(g){return v=>g.checkExist("n_doc",v.value).pipe((0,r.U)(p=>null===p.exist?null:{validateNumDoc:p.exist}))}static validateCode(g){return v=>g.checkExist("code",v.value).pipe((0,r.U)(p=>null===p.exist?null:{validateCode:p.exist}))}static validateEmailExist(g){return v=>g.checkEmailExist(v.value).pipe((0,r.U)(p=>null===p.exist?null:{validateEmailExist:p.exist}))}static validateRoleExist(g){return v=>g.checkRoleExist(v.value).pipe((0,r.U)(p=>null===p.exist?null:{validateRoleExist:p.exist}))}}}}]);