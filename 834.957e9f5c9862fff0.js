"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[834],{3834:(D,x,o)=>{o.r(x),o.d(x,{StudyRequetsModule:()=>O});var Z=o(9808),f=o(325),p=o(8437),r=o(5e3);const m=[{path:"",component:p.R}];let v=(()=>{class u{}return u.\u0275fac=function(S){return new(S||u)},u.\u0275mod=r.oAB({type:u}),u.\u0275inj=r.cJS({imports:[[f.Bz.forChild(m)],f.Bz]}),u})();var M=o(8203);let O=(()=>{class u{}return u.\u0275fac=function(S){return new(S||u)},u.\u0275mod=r.oAB({type:u}),u.\u0275inj=r.cJS({imports:[[Z.ez,v,M.m]]}),u})()},8437:(D,x,o)=>{o.d(x,{R:()=>_t});var Z=o(6087),f=o(2654),p=o(4850),r=o(2986),m=o(3075),v=o(8966),M=o(5439),O=o.n(M),u=o(8929),y=o(7625),S=o(13),H=o(1059),j=o(2868),N=o(9002),t=o(5e3),V=o(5120),J=o(7814),B=o(2075),I=o(520),E=o(591),b=o(2340),W=o(7261);let U=(()=>{class a{constructor(e,n){this.http=e,this.snackBar=n,this.dataOptionsForms$=new E.X(null),this.studyRequestEditSubject$=new E.X(null),this.urlUtils="src/app/shared/utils/data/",this.resultSubject$=new E.X(null)}get optionsForms$(){return this.dataOptionsForms$}get resultItems$(){return this.resultSubject$}setItems(e){this.resultSubject$.next(e)}get studyRequestOnEdit(){return this.studyRequestEditSubject$}setStudyRequestOnEdit(e){this.studyRequestEditSubject$.next(e)}storeStudyRequest(e){return this.http.post(`${b.N.API}study_requests`,e).pipe((0,p.U)(n=>(this.openSnackBar("Se cre\xf3 correctamente","success-snack-bar"),n.data)))}updateStudyRequest(e){const n=e.id;return e._method="put",this.http.post(`${b.N.API}study_requests/${n}`,e).pipe((0,p.U)(i=>(this.openSnackBar("Actualizado correctamente","success-snack-bar"),i.data)))}deleteStudyRequest(e){return this.http.delete(`${b.N.API}study_requests/${e}`).pipe((0,p.U)(n=>(this.openSnackBar("Eliminado correctamente","success-snack-bar"),n.data)))}getStudyRequest(e){return this.http.get(`${b.N.API}study_requests/${e}`).pipe((0,p.U)(n=>n.data))}getStudyRequests(e=1,n=20,i="",s="desc",d=""){return this.http.get(`${b.N.API}study_requests`,{params:(new I.LE).set("page",e.toString()).set("filter",i).set("sort",s).set("patient_id",d).set("per_page",n.toString())}).pipe((0,p.U)(c=>(this.setStudyRequestOnEdit(null),this.setItems(c),c)))}dataSelect(){return this.http.get("assets/data/data_selects.json").pipe((0,p.U)(e=>e))}openSnackBar(e,n,i=""){this.snackBar.open(e,i,{duration:2e3,horizontalPosition:"center",verticalPosition:"top",panelClass:n})}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(I.eN),t.LFG(W.ux))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var z=o(384),G=o(325),L=o(2415),g=o(9224),$=o(277),Q=o(7423),Y=o(5245),R=o(9808),F=o(7322),X=o(7531),w=o(1079),k=o(508),K=o(7510),P=o(6856),tt=o(6891),et=o(4107);function it(a,l){if(1&a&&(t.TgZ(0,"mat-option",32),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.Q6J("value",e.id),t.xp6(1),t.lnq(" (",e.code,") ",e.name," ",e.last_name," ")}}function nt(a,l){if(1&a&&(t.TgZ(0,"mat-option",32),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.name," ")}}function st(a,l){if(1&a&&(t.TgZ(0,"mat-form-field",34)(1,"mat-label"),t._uU(2,"Estado de la Solicitud"),t.qZA(),t.TgZ(3,"mat-select",35)(4,"mat-option",36),t._uU(5,"Ninguno"),t.qZA(),t.YNc(6,nt,2,2,"mat-option",10),t.qZA()()),2&a){const e=l.ngIf;t.xp6(6),t.Q6J("ngForOf",e.status_solicitudes)}}function ot(a,l){if(1&a&&(t.ynx(0),t.YNc(1,st,7,1,"mat-form-field",33),t.ALo(2,"async"),t.BQk()),2&a){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,1,e.dataSelects$))}}function at(a,l){if(1&a){const e=t.EpF();t.TgZ(0,"div",5)(1,"mat-form-field",6)(2,"mat-label"),t._uU(3,"Paciente"),t.qZA(),t._UZ(4,"input",7),t.TgZ(5,"mat-autocomplete",8,9),t.YNc(7,it,2,4,"mat-option",10),t.ALo(8,"async"),t.qZA(),t.TgZ(9,"button",11),t.NdJ("click",function(){return t.CHM(e),t.oxw().addPatient()}),t.TgZ(10,"mat-icon",12),t._uU(11,"add_circle"),t.qZA()(),t.TgZ(12,"mat-error"),t._UZ(13,"mvd-errors-messages",13),t.qZA()(),t.TgZ(14,"mat-form-field",14)(15,"mat-label"),t._uU(16,"Fecha de solicitud"),t.qZA(),t.TgZ(17,"input",15),t.NdJ("dateChange",function(i){return t.CHM(e),t.oxw().formatDate(i,"date_sol")})("click",function(){return t.CHM(e),t.MAs(20).open()}),t.qZA(),t._UZ(18,"mat-datepicker-toggle",16)(19,"mat-datepicker",null,17),t.qZA(),t.TgZ(21,"div",18)(22,"mvd-input-select-add-item",19),t.NdJ("addOption",function(i){return t.CHM(e),t.oxw().addFinanciacion(i)})("changeValue",function(i){return t.CHM(e),t.oxw().changeFinanciacion(i)}),t.qZA()(),t.TgZ(23,"div",18)(24,"mvd-input-select-add-item",20),t.NdJ("addOption",function(i){return t.CHM(e),t.oxw().addLab(i)})("changeValue",function(i){return t.CHM(e),t.oxw().changeLab(i)}),t.qZA()(),t.TgZ(25,"div",18)(26,"mvd-input-select-add-item",19),t.NdJ("addOption",function(i){return t.CHM(e),t.oxw().addStudyType(i)})("changeValue",function(i){return t.CHM(e),t.oxw().changeStudyType(i)}),t.qZA()(),t.TgZ(27,"div",18),t.YNc(28,ot,3,3,"ng-container",21),t.qZA(),t.TgZ(29,"mat-form-field",22)(30,"mat-label"),t._uU(31,"Observaciones"),t.qZA(),t._UZ(32,"textarea",23),t.qZA(),t.TgZ(33,"div",24)(34,"div",25)(35,"p"),t._uU(36,"Selecciona una Muestra para crear un resultado"),t.qZA(),t.TgZ(37,"mvd-input-select-add-item",26),t.NdJ("addOption",function(){return t.CHM(e),t.oxw().addSample()})("changeValue",function(i){return t.CHM(e),t.oxw().changeSample(i)}),t.qZA()(),t.TgZ(38,"div",27)(39,"span",28)(40,"button",29),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return i.disable?i.openEditResult():i.openAddResult()}),t._uU(41),t.qZA()(),t._UZ(42,"span",28)(43,"span",28)(44,"span",28),t.qZA()(),t.TgZ(45,"div",30),t._UZ(46,"span",28)(47,"span",28)(48,"span",28),t.TgZ(49,"button",31),t.NdJ("click",function(){return t.CHM(e),t.oxw().submit()}),t._uU(50,"Guardar"),t.qZA()()()}if(2&a){const e=t.MAs(6),n=t.MAs(20),i=t.oxw();t.xp6(4),t.Q6J("matAutocomplete",e),t.xp6(1),t.Q6J("displayWith",i.getNamePatient.bind(i)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(8,29,i.patients$)),t.xp6(2),t.Q6J("disabled",i.disable),t.xp6(4),t.Q6J("campo",i.form.get("patient_id").errors)("name","Paciente"),t.xp6(4),t.Q6J("matDatepicker",n),t.xp6(1),t.Q6J("for",n),t.xp6(4),t.Q6J("value",i.valueFinanciacionSelect)("options",i.optionsFinancings)("namePlaceholder","Financiaci\xf3n")("disabled",i.disable),t.xp6(2),t.Q6J("value",i.valueLabSelect)("options",i.optionsLabs)("disabled",i.disable)("namePlaceholder","Laboratorio"),t.xp6(2),t.Q6J("value",i.valueTypeStudySelect)("options",i.optionsStudies)("namePlaceholder","Tipo de Estudio")("disabled",i.disable),t.xp6(2),t.Q6J("ngIf",i.edit),t.xp6(9),t.Q6J("value",i.valueSampleSelect)("options",i.optionsSample)("namePlaceholder","Muestras")("addOptionRoute",i.routePatient)("disabled",i.disable||!i.optionsSample.length),t.xp6(3),t.Q6J("disabled",!i.valueSampleSelect),t.xp6(1),t.hij("",i.disable?"Ver ":"Guardar y Crear ","Resultado "),t.xp6(8),t.Q6J("disabled",!i.form.valid)}}function dt(a,l){1&a&&(t.TgZ(0,"div",37)(1,"div",38),t._UZ(2,"div")(3,"div")(4,"div"),t.qZA()())}let lt=(()=>{class a{constructor(e,n,i,s,d,c,h,C,A,T,q){this.dialogRef=e,this.data=n,this.fb=i,this.patientService=s,this.resultService=d,this.sampleService=c,this.studyRequestsService=h,this.authService=C,this.router=A,this.dialog=T,this.genResultService=q,this.optionsFinancings=[],this.optionsStudies=[],this.optionsLabs=[],this.optionsSample=[],this.edit=!0,this.subscriptions=new f.w,this.destroy$=new u.xQ,this.disable=!1,this.createForm(),this.dataSelects$=this.studyRequestsService.dataSelect()}ngOnInit(){var e,n,i;this.edit=!!(null===(e=this.data)||void 0===e?void 0:e.id),this.form.get("patient_id").valueChanges.pipe((0,y.R)(this.destroy$),(0,S.b)(500),(0,H.O)("")).subscribe(s=>{this.patients$=this.patientService.filterPatients(1,20,s).pipe((0,r.q)(1),(0,p.U)(d=>(this.patients=d.data.data,d.data.data)))}),this.data&&Object.keys(this.data).length>1?(this.patient=null===(n=this.data)||void 0===n?void 0:n.patient,this.studyRequest$=this.studyRequestsService.studyRequestOnEdit.pipe((0,j.b)(s=>{s&&this.updateForm(s)}))):((null===(i=this.data)||void 0===i?void 0:i.patient_id)&&this.subscriptions.add(this.patientService.patientOnEdit.subscribe(s=>{this.patient=s;const d=Object.assign({},this.data);d.patient=s,this.updateForm(d)})),this.subscriptions.add(this.authService.currentUser.asObservable().subscribe(s=>{var d;(null===(d=this.data)||void 0===d?void 0:d.user_id)||this.form.patchValue({user_id:s.id})})))}createForm(){this.form=this.fb.group({id:[null],user_id:[null,m.kI.required],patient_id:[null],sample_id:[null],date_sol:[null],financing_id:[null],obs:[null],lab_id:[null],study_type_id:[null],status_req:["Solicitado"]}),this.formatOptionsSelect()}updateForm(e){var n,i;this.patients=[e.patient],this.form.patchValue({id:null==e?void 0:e.id,obs:e.obs,user_id:null==e?void 0:e.user_id,patient_id:null==e?void 0:e.patient_id,sample_id:null===(n=this.data)||void 0===n?void 0:n.sample_id,date_sol:null==e?void 0:e.date_sol,lab_id:null==e?void 0:e.lab_id,financing_id:null==e?void 0:e.financing_id,study_type_id:null==e?void 0:e.study_type_id,status_req:(null==e?void 0:e.status_req)||"Solicitado"}),this.changeLab(null==e?void 0:e.lab_id),this.changeFinanciacion(null==e?void 0:e.financing_id),this.changeStudyType(null==e?void 0:e.study_type_id),this.changeSample(null==e?void 0:e.sample_id),(null===(i=this.data)||void 0===i?void 0:i.result_id)&&(this.form.get("user_id").disable(),this.form.get("patient_id").disable(),this.form.get("sample_id").disable(),this.form.get("date_sol").disable(),this.form.get("lab_id").disable(),this.form.get("financing_id").disable(),this.form.get("study_type_id").disable(),this.disable=!0)}submit(e=!1){const n=Object.assign({},this.form.value);n.addResult=e,this.dialogRef.close(n)}formatDate(e,n){let i=e.value;this.form.get(n).setValue(O()(i).format("YYYY-MM-DD HH:mm:ss"))}onNoClick(){this.dialogRef.close()}changeFinanciacion(e){this.form.get("financing_id").setValue(e),this.valueFinanciacionSelect=e}addFinanciacion(e){this.subscriptions.add(this.resultService.storeFinancings$(e).subscribe())}changeLab(e){this.form.get("lab_id").setValue(e),this.valueLabSelect=e}addLab(e){this.subscriptions.add(this.resultService.storeLabs$(e).subscribe())}changeStudyType(e){this.form.get("study_type_id").patchValue(e),this.valueTypeStudySelect=e}addStudyType(e){this.subscriptions.add(this.resultService.storeTypeSudy$(e).subscribe())}changeSample(e){this.form.get("sample_id").setValue(e),this.valueSampleSelect=e}addSample(){this.dialogRef.close()}formatOptionsSelect(){this.subscriptions.add(this.resultService.typeStudies$.subscribe(e=>{this.studies=e,this.optionsStudies=null==e?void 0:e.map(n=>({value:n.id,text:n.name}))})),this.subscriptions.add(this.resultService.financing$.subscribe(e=>{this.financings=e,this.optionsFinancings=null==e?void 0:e.map(n=>({value:n.id,text:n.name}))})),this.subscriptions.add(this.resultService.labs$.subscribe(e=>{this.labs=e,this.optionsLabs=null==e?void 0:e.map(n=>({value:n.id,text:n.name}))}))}formatOptionsSamples(e){this.subscriptions.add(this.sampleService.getSamples(1,1e3,"","desc",e.id.toString()).subscribe(n=>{var i;this.samples=n.data.data,this.optionsSample=null===(i=this.samples)||void 0===i?void 0:i.map(s=>{var d,c,h;return{value:s.id,text:`${s.code} -- ${null===(d=null==s?void 0:s.type_sample)||void 0===d?void 0:d.name} ${(null===(c=null==s?void 0:s.topography)||void 0===c?void 0:c.name)?"-- "+(null===(h=null==s?void 0:s.topography)||void 0===h?void 0:h.name):""}`}})}))}getNamePatient(e){if(e&&this.patients)return this.patient=this.patients.find(n=>n.id===e),this.routePatient=`/pacientes/paciente/${e}`,this.formatOptionsSamples(this.patient),`(${this.patient.code}) ${this.patient.name} ${this.patient.last_name}`}addPatient(){this.router.navigate(["/pacientes/paciente"]),this.dialogRef.close()}openAddResult(){this.submit(!0)}openEditResult(){const e={patient_id:this.form.get("patient_id").value,sample_id:this.form.get("sample_id").value};this.subscriptions.add(this.resultService.showResult(this.data.result_id).subscribe()),this.openDialogResult(this.patient,e)}openDialogResult(e,n){return this.dialog.open(N.N,{width:"70vw",minWidth:"370px",height:"90vh",data:{patient:e,element:n}}).afterClosed().pipe((0,r.q)(1)).subscribe(d=>{this.resultService.setItem(null),this.genResultService.setGenResults(null),this.onNoClick()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.subscriptions.unsubscribe()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(v.so),t.Y36(v.WI),t.Y36(m.qu),t.Y36(V.$),t.Y36(J.L),t.Y36(B.e),t.Y36(U),t.Y36(z.e),t.Y36(G.F0),t.Y36(v.uw),t.Y36(L.X))},a.\u0275cmp=t.Xpm({type:a,selectors:[["mvd-modal-add-edit"]],decls:12,vars:5,consts:[["fxFlex","100",1,""],["mat-button","",1,"btn-close-modal",3,"click"],[3,"formGroup"],["fxFlex","100","fxLayout","row wrap","fxFlex.lt-md","100","fxLayoutAlign","space-between center",4,"ngIf","ngIfElse"],["loading",""],["fxFlex","100","fxLayout","row wrap","fxFlex.lt-md","100","fxLayoutAlign","space-between center"],["appearance","outline","fxFlex","74","fxFlex.lt-md","100",1,""],["matInput","","aria-label","Paciente","placeholder","c\xf3digo, documento, nombre","formControlName","patient_id","type","text",3,"matAutocomplete"],[3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["type","button","matSuffix","","mat-icon-button","","aria-label","Add",1,"add-icon-input",3,"disabled","click"],["color","primary"],[3,"campo","name"],["fxFlex","25","fxFlex.lt-md","100","appearance","outline",1,""],["formControlName","date_sol","matInput","","placeholder","Fecha de solicitud","autocomplete","off",3,"matDatepicker","dateChange","click"],["matSuffix","",3,"for"],["pickerdate_sol",""],["fxFlex","24","fxFlex.lt-md","100",1,""],[3,"value","options","namePlaceholder","disabled","addOption","changeValue"],[3,"value","options","disabled","namePlaceholder","addOption","changeValue"],[4,"ngIf"],["appearance","outline","fxFlex","100","fxFlex.lt-md","100",1,""],["formControlName","obs","matInput","","type","text","placeholder","Observaciones"],["fxLayout","row wrap","fxFlex","100","fxFlex.lt-md","100",1,"content-group-form"],["fxFlex","100","fxFlex.lt-md","100",1,""],[3,"value","options","namePlaceholder","addOptionRoute","disabled","addOption","changeValue"],["fxFlex","100","fxFlex.lt-md","100"],["fxFlex","30"],["fxFlex","100","mat-flat-button","","color","primary",1,"",3,"disabled","click"],["fxFlex","100","fxLayout","row","fxFlex.lt-md","100","fxLayoutAlign","between",1,"btn-actions","mvd-col1--1"],["fxFlex","10","mat-flat-button","","type","submit","color","primary",1,"",3,"disabled","click"],[3,"value"],["class","","appearance","outline","fxFlex","100",4,"ngIf"],["appearance","outline","fxFlex","100",1,""],["placeholder","Seleccione...","formControlName","status_req"],["value","null"],[1,"div-content"],[1,"loading"]],template:function(e,n){if(1&e&&(t.TgZ(0,"mat-card",0)(1,"button",1),t.NdJ("click",function(){return n.onNoClick()}),t.TgZ(2,"mat-icon"),t._uU(3,"close"),t.qZA()(),t.TgZ(4,"mat-card-header")(5,"h3"),t._uU(6,"Solicitud de Estudio"),t.qZA()(),t.TgZ(7,"form",2),t.YNc(8,at,51,31,"div",3),t.ALo(9,"async"),t.qZA()(),t.YNc(10,dt,5,0,"ng-template",null,4,t.W1O)),2&e){const i=t.MAs(11);t.xp6(7),t.Q6J("formGroup",n.form),t.xp6(1),t.Q6J("ngIf",t.lcZ(9,3,n.studyRequest$)||!n.edit)("ngIfElse",i)}},directives:[g.a8,$.yH,Q.lW,Y.Hw,g.dk,m._Y,m.JL,m.sg,R.O5,$.xw,$.Wh,F.KE,F.hX,X.Nt,m.Fj,w.ZL,m.JJ,m.u,w.XC,R.sg,k.ey,F.R9,F.TO,K.g,P.hl,P.nW,P.Mq,tt.F,et.gD],pipes:[R.Ov],styles:[".mat-card[_ngcontent-%COMP%]{box-shadow:none!important;margin:0!important;padding-left:16px!important}.content-group-form[_ngcontent-%COMP%]{margin-bottom:1rem}form[_ngcontent-%COMP%]   .btn-actions[_ngcontent-%COMP%]{width:100%!important;grid-column:1/-1}form[_ngcontent-%COMP%]   .btn-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto}"],changeDetection:0}),a})();var ut=o(953),rt=o(3160);function ct(a,l){1&a&&t.GkF(0)}function pt(a,l){if(1&a&&(t.ynx(0),t.TgZ(1,"mat-card",3)(2,"mat-card-header")(3,"mat-card-title"),t._uU(4,"Solicitudes"),t.qZA(),t.TgZ(5,"mat-card-subtitle"),t._uU(6,"Administrar Solicitudes de Estudio"),t.qZA()(),t.TgZ(7,"mat-card-content"),t.YNc(8,ct,1,0,"ng-container",4),t.qZA(),t._UZ(9,"span",5),t.qZA(),t.BQk()),2&a){const e=t.oxw(),n=t.MAs(4);t.xp6(8),t.Q6J("ngIf",!e.typeTab)("ngIfThen",n)}}function mt(a,l){1&a&&t.GkF(0)}function ht(a,l){if(1&a&&t.YNc(0,mt,1,0,"ng-container",4),2&a){const e=t.oxw(),n=t.MAs(4);t.Q6J("ngIf",e.typeTab)("ngIfThen",n)}}const gt=function(){return[20,50,100]};function vt(a,l){if(1&a){const e=t.EpF();t.TgZ(0,"div",6)(1,"mvd-input-search",7),t.NdJ("changeSearch",function(i){return t.CHM(e),t.oxw().search(i)}),t.qZA(),t.TgZ(2,"div",8)(3,"button",9),t.NdJ("click",function(){return t.CHM(e),t.oxw().openDialog()}),t.TgZ(4,"mat-icon",10),t._uU(5,"add"),t.qZA(),t.TgZ(6,"span"),t._uU(7,"Crear"),t.qZA()()()(),t.TgZ(8,"mvd-data-table",11),t.NdJ("actionChange",function(i){return t.CHM(e),t.oxw().itemAction(i)}),t.ALo(9,"async"),t.qZA(),t.TgZ(10,"mat-paginator",12),t.NdJ("page",function(i){return t.CHM(e),t.oxw().paginatorChange(i)}),t.ALo(11,"async"),t.qZA()}if(2&a){const e=t.oxw();t.xp6(1),t.Q6J("noteFilterBy","Filtra por n\xba documento, nombre, apellido, tel\xe9fono, email o c\xf3digo del paciente. - Estado. - C\xf3digo de muestra. - Tipo de estudio - Fecha"),t.xp6(7),t.Q6J("columns",e.columns)("dataSource",t.lcZ(9,6,e.dataSource)),t.xp6(2),t.Q6J("length",t.lcZ(11,8,e.totalResut))("pageSize",e.perPage)("pageSizeOptions",t.DdM(10,gt))}}let _t=(()=>{class a{constructor(e,n,i,s){this.studyRequestService=e,this.resultService=n,this.dialog=i,this.genResultService=s,this.typeTab=!1,this.columns=[{title:"Fecha",col:"date_sol",pipe:"dd/MM/yyyy",class:"w-5-100"},{title:"Paciente",col:"patient_full_name",class:"w-30-100"},{title:"Tipo de estudio",col:"study_type_name",class:"w-10-100"},{title:"Estado",col:"status_req",class:"w-10-100",classCell:"classCellStatus"},{title:"Financiaci\xf3n",col:"financing_name",class:"w-10-100"},{title:"Laboratiorio",col:"lab_name",class:"w-20-100"},{title:"Resultado",col:"result_true",type:"boolean",class:"w-5-100"}],this.pageDefault=1,this.perPage=10,this.orden="desc",this.filter="",this.subscriptions=new f.w,this.result=this.studyRequestService.resultItems$}ngOnInit(){this.getStudyRequests(this.pageDefault,this.perPage,this.filter,this.orden)}paginatorChange(e){this.getStudyRequests(e.pageIndex+1,e.pageSize)}getStudyRequests(e=1,n=20,i="",s="desc"){this.subscriptions.add(this.studyRequestService.getStudyRequests(e,n,i,s,this.patient_id).subscribe(d=>this.loadData()))}loadData(){this.dataSource=this.result.pipe((0,p.U)(e=>e.data.data.map(i=>{var s,d,c,h,C,A,T,q;let _;return _="Solicitado"===(null==i?void 0:i.status_req)?"danger-word":"Recibido"===(null==i?void 0:i.status_req)?"warn-word":"Entregado"===(null==i?void 0:i.status_req)?"success-word":"EnProceso"===(null==i?void 0:i.status_req)||"En Proceso"===(null==i?void 0:i.status_req)?"process-word":"",{id:null==i?void 0:i.id,user_id:null==i?void 0:i.user_id,sample_id:null==i?void 0:i.sample_id,sample:null==i?void 0:i.sample,patient:null==i?void 0:i.patient,patient_id:null==i?void 0:i.patient_id,date_sol:null==i?void 0:i.date_sol,financing_name:null===(s=null==i?void 0:i.financing)||void 0===s?void 0:s.name,financing:null==i?void 0:i.financing,lab:null==i?void 0:i.lab,obs:null==i?void 0:i.obs,financing_id:null==i?void 0:i.financing_id,lab_name:null===(d=null==i?void 0:i.lab)||void 0===d?void 0:d.name,lab_id:null==i?void 0:i.lab_id,study_type_id:null==i?void 0:i.study_type_id,study_type_name:null===(c=null==i?void 0:i.study_type)||void 0===c?void 0:c.name,study_type:null==i?void 0:i.study_type,patient_full_name:`(${null===(h=null==i?void 0:i.patient)||void 0===h?void 0:h.code}) ${null===(C=null==i?void 0:i.patient)||void 0===C?void 0:C.name} ${null===(A=null==i?void 0:i.patient)||void 0===A?void 0:A.last_name}`,result:null==i?void 0:i.result,result_id:null===(T=null==i?void 0:i.result)||void 0===T?void 0:T.id,result_true:(null===(q=null==i?void 0:i.result)||void 0===q?void 0:q.id)?1:0,status_req:null==i?void 0:i.status_req,classCellStatus:_}}))),this.totalResut=this.result.pipe((0,p.U)(e=>e.data.total))}search(e){this.getStudyRequests(this.pageDefault,this.perPage,e,this.orden)}deleteItem(e){return this.studyRequestService.deleteStudyRequest(e)}itemAction(e){"delete"===e.action&&this.subscriptions.add(this.deleteItem(e.element.id).pipe((0,r.q)(1)).subscribe()),"edit"===e.action&&(this.studyRequestService.setStudyRequestOnEdit(e.element),this.openDialog(e.element))}openDialog(e){return this.dialog.open(lt,{width:"950px",data:this.patient_id&&!e?{patient_id:this.patient_id}:e}).afterClosed().pipe((0,r.q)(1)).subscribe(s=>{s?s.id?s.addResult?this.updateStudyRequest(s,!0):this.updateStudyRequest(s):s.addResult?this.storeStudyRequest(s,!0):this.storeStudyRequest(s):this.getStudyRequests(this.pageDefault,this.perPage,this.filter,this.orden)})}updateStudyRequest(e,n){this.studyRequestService.updateStudyRequest(e).pipe((0,r.q)(1)).subscribe(i=>{this.getStudyRequests(this.pageDefault,this.perPage,this.filter,this.orden),n&&this.openAddResult(i)})}storeStudyRequest(e,n){this.studyRequestService.storeStudyRequest(e).pipe((0,r.q)(1)).subscribe(i=>{this.getStudyRequests(this.pageDefault,this.perPage,this.filter,this.orden),n&&this.openAddResult(i)})}ngOnDestroy(){this.subscriptions.unsubscribe()}openDialogResult(e,n){return this.dialog.open(N.N,{width:"70vw",minWidth:"370px",height:"90vh",data:{patient:e,element:n}}).afterClosed().pipe((0,r.q)(1)).subscribe(d=>{this.resultService.setItem(null),this.genResultService.setGenResults(null)})}openAddResult(e){this.openDialogResult(e.patient,{patient_id:e.patient_id,sample_id:e.sample_id,date_sol:e.date_sol,financing_id:e.financing_id,lab_id:e.lab_id,study_type_id:e.study_type_id,study_request_id:e.id})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(U),t.Y36(J.L),t.Y36(v.uw),t.Y36(L.X))},a.\u0275cmp=t.Xpm({type:a,selectors:[["mvd-study-requests"]],viewQuery:function(e,n){if(1&e&&t.Gf(Z.NW,7),2&e){let i;t.iGM(i=t.CRH())&&(n.paginator=i.first)}},inputs:{typeTab:"typeTab",patient_id:"patient_id"},decls:5,vars:2,consts:[[4,"ngIf","ngIfElse"],["isTab",""],["content",""],[1,"card","mat-elevation-z16","animate__animated","animate__slideInRight"],[4,"ngIf","ngIfThen"],[1,"border"],[1,"header-table"],[3,"noteFilterBy","changeSearch"],[1,"actions"],["mat-flat-button","","color","primary",3,"click"],[1,"material-icons-round"],[3,"columns","dataSource","actionChange"],["showFirstLastButtons","",3,"length","pageSize","pageSizeOptions","page"]],template:function(e,n){if(1&e&&(t.YNc(0,pt,10,2,"ng-container",0),t.YNc(1,ht,1,2,"ng-template",null,1,t.W1O),t.YNc(3,vt,12,11,"ng-template",null,2,t.W1O)),2&e){const i=t.MAs(2);t.Q6J("ngIf",!n.typeTab)("ngIfElse",i)}},directives:[R.O5,g.a8,g.dk,g.n5,g.$j,g.dn,ut.V,Q.lW,Y.Hw,rt.Q,Z.NW],pipes:[R.Ov],styles:[".header-table[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr;grid-gap:1rem;gap:1rem}.header-table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);justify-content:space-around!important;justify-items:right;grid-column-gap:5px;column-gap:5px}.header-table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:38px}"]}),a})()}}]);